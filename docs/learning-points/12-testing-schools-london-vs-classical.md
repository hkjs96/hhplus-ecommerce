# 런던파 vs 고전파(고전학파) 테스트 스타일 정리

> 목적: “테스트 대역(특히 Mock)을 어떻게 바라볼 것인가?”에 대한 대표적인 2가지 스타일을 비교하고, 본 프로젝트 기준의 실무적 선택 기준을 정리한다.

---

## 1) 한 줄 정의

- **고전파(Classical)**: “상태(state) 검증” 중심. 가능하면 실제 객체/실제 협력 객체를 사용하고, 부작용 경계(외부 시스템)에만 대역을 둔다.
- **런던파(London/Mockist)**: “행위(behavior) 검증” 중심. 협력 객체를 적극적으로 Mock 처리하고, 상호작용(호출 여부/순서/인자)을 검증한다.

---

## 2) 무엇이 다르나? (관심사)

| 관점 | 고전파 | 런던파 |
|------|--------|--------|
| 테스트가 보호하는 것 | 최종 결과(상태) | 협력/상호작용(행위) |
| 실패의 의미 | “기능이 깨짐”에 가깝다 | “협력 계약이 깨짐”일 수 있다 |
| 변경에 대한 내성 | 내부 리팩토링에 비교적 강함 | 협력 구조 변경에 취약할 수 있음 |
| 속도 | 느릴 수 있음(실제 객체 많음) | 빠를 수 있음(Mock 중심) |
| 추천 대상 | 도메인 규칙/유스케이스 결과 | 경계/어댑터/콜백/이벤트 발행 등 |

---

## 3) 장단점(실무 감각)

### 고전파 장점
- 협력 구조가 바뀌어도 “결과가 동일”하면 테스트가 유지되는 경우가 많다.
- Mock 설정을 과도하게 하지 않아 테스트가 비교적 단순해진다.

### 고전파 단점
- 실제 협력 객체가 많아지면 셋업이 무거워지고, 실패 원인 범위가 커질 수 있다.
- 외부 시스템(DB/Redis/Kafka 등)이 섞이면 “단위 테스트”가 “통합 테스트”로 커지기 쉽다.

### 런던파 장점
- 경계가 명확한 협력(외부 API 호출, 이벤트 발행, 알림 전송 등)을 빠르게 검증할 수 있다.
- 실패 지점이 상대적으로 좁아서 원인 파악이 빠를 수 있다.

### 런던파 단점
- 구현/협력 방식이 조금만 바뀌어도 테스트가 깨질 수 있다(강결합).
- “호출은 했지만 결과적으로는 잘못된 상태” 같은 결함을 놓칠 수 있다(상태 검증 부재).

---

## 4) 테스트 대역은 어디에 두는가?

둘 다 공통으로 권장되는 기준은 “경계”입니다.

- **대역을 두기 좋은 곳(경계)**: 외부 API, 메시지 브로커, 시간, 랜덤, 파일/네트워크, 메일/알림
- **대역을 남발하면 안 좋은 곳(핵심 규칙)**: 도메인 규칙/상태 전이/가격 계산/재고 차감 규칙 등

---

## 5) 본 프로젝트 기준의 결론(견해)

이 레포는 Testcontainers 기반(MySQL/Redis) 통합 테스트를 중요한 증빙으로 사용합니다.  
그래서 “Mock을 최대한 줄이는 고전파”가 무조건 정답은 아니고, 아래처럼 **혼합 전략**이 현실적이라고 생각합니다.

1. **도메인 규칙은 고전파에 가깝게**: 상태/불변식 중심으로 단위 테스트(순수 객체/순수 로직)로 보호한다.
2. **외부 부작용은 런던파를 섞는다**: “어떤 이벤트를 발행해야 하는가 / 어떤 외부 호출을 해야 하는가”처럼 경계에서 행위 검증이 유효하다.
3. **DB/Redis를 포함한 흐름은 통합 테스트로 증빙한다**: 동시성/락/트랜잭션/이벤트 AFTER_COMMIT은 Mock만으로 신뢰하기 어렵다.

---

## 6) 언제 무엇을 선택할까? (빠른 기준)

- “리팩토링이 잦고 결과가 중요” → 고전파(상태 검증)
- “경계 계약이 중요(발행/호출/전송)” → 런던파(행위 검증)
- “동시성/트랜잭션/이벤트 타이밍이 핵심” → 통합 테스트(Testcontainers)

