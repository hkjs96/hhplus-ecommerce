# 부하 상황에서 Tomcat 스레드 상태 변화: 무엇이 “병목 신호”인가?

> 목적: 10주차 체크리스트의 “부하로 인한 스프링 톰캣 스레드 상태 변화”를 운영/관측 관점에서 이해한다.

---

## 1) Tomcat 스레드 풀은 무엇을 하는가?

Spring Boot 내장 Tomcat은 요청을 처리하기 위해 **요청 처리 스레드 풀**을 사용합니다.

부하가 올라가면 보통 아래 순서로 현상이 나타납니다.

1. 동시 요청 증가
2. 요청 처리 시간이 늘어남(대기/락/IO/GC 등)
3. 처리 스레드가 점점 점유됨(바빠짐)
4. 스레드 풀이 포화되면 요청이 큐에서 대기하거나, 거부/타임아웃이 증가

즉, “스레드 상태 변화”는 원인이 아니라, **병목이 드러나는 표면 신호**인 경우가 많습니다.

---

## 2) 부하에서 자주 보는 상태 변화(감각)

- `RUNNABLE`이 많아진다  
  - CPU-bound(연산/GC) 또는 busy loop, 과도한 로깅 등이 의심 후보
- `WAITING`/`TIMED_WAITING`이 많아진다  
  - 락 대기, DB 커넥션 대기, 외부 호출 대기 등이 의심 후보

현업에서는 “스레드 상태만 보고 결론” 내리기보다는,
**RED 지표(에러/지연) → 스레드/풀 포화 신호 → 원인(DB/GC/의존성)** 순서로 드릴다운합니다.

---

## 3) 무엇을 보면 되나? (관측 포인트)

아래는 “스레드 풀이 포화되는지”를 판단할 때 흔히 보는 신호입니다.

- **증상(사용자 영향)**: p95/p99 지연 상승, 5xx/timeout 증가
- **Tomcat/스레드 풀**: active thread 증가, queue 증가, reject/timeout 발생
- **DB 커넥션 풀(Hikari)**: active/idle/pending 증가(특히 pending)
- **GC/메모리**: GC pause 증가, heap 압박

이 레포에서는 Week10에서 아래 문서로 관측/해석 흐름을 정리합니다.
- `docs/week10/monitoring-metrics.md`
- `docs/week10/RUNBOOK.md`

---

## 4) 체크리스트 답변용 요약(3줄)

1. 부하가 커지면 “요청 처리 시간 증가 → Tomcat 스레드 점유 증가 → 풀 포화/대기/타임아웃” 흐름이 생긴다.  
2. `RUNNABLE`/`WAITING` 같은 스레드 상태 변화는 원인이 아니라, 병목이 드러나는 신호다.  
3. RED 지표로 증상을 확인하고, 스레드/풀 포화 신호와 DB/GC 같은 원인 신호로 드릴다운해야 한다.
