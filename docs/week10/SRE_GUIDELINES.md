# Week 10 - SRE 기본 지침 (학습용)

이 문서는 이 프로젝트(ecommerce: Spring Boot + MySQL + Redis + Kafka + Prometheus/Grafana + k6)를 “운영 가능한 서비스”로 본다고 가정했을 때의 SRE 기본 지침을 정리한 학습 자료입니다. 실제 조직/환경에 따라 숫자와 프로세스는 달라질 수 있습니다.

## 1) 목표: “안정적으로 바꾸고, 빠르게 복구한다”
- **변경으로 장애를 만들지 않는 것**보다 더 중요한 건, *장애가 나도 빠르게 감지하고 빠르게 복구하는 것*입니다.
- 모든 운영 의사결정은 아래 3가지를 만족하도록 설계합니다.
  - **관측 가능성(Observability):** 지금 무슨 일이 일어나고 있는지 알 수 있다.
  - **복구 가능성(Recoverability):** 문제가 생겨도 서비스 영향 시간을 최소화한다.
  - **변경 안전성(Change Safety):** 배포/설정 변경이 안전하게 이루어진다.

## 2) “운영”에서 가장 먼저 합의해야 하는 것들
### 2.1 SLI/SLO
- SLI: 사용자 관점의 지표(예: 요청 성공률/지연시간)
- SLO: SLI의 목표치(예: “30일 기준 성공률 99.9%”)
- SLI/SLO는 “대시보드 예쁘게”가 아니라 **알림과 작업 우선순위**의 기준이 됩니다.

### 2.2 에러 버짓(Error Budget)
- “얼마나 실패해도 되는가”를 숫자로 정의합니다.
- 예: 30일 가용성 SLO 99.9%면 허용 다운타임은 약 43분.
- 에러 버짓을 많이 쓰고 있다면: 기능 개발 속도보다 안정성 개선이 우선입니다.

### 2.3 런북/온콜
- 장애 대응은 개인 역량이 아니라 **문서와 반복 가능한 절차**로 수행되어야 합니다.
- 장애 유형별로 “어디를 보고, 무엇을 확인하고, 어떤 순서로 완화할지”가 런북에 있어야 합니다.

## 3) 운영 준비(Production Readiness) 체크리스트
### 3.1 배포/롤백
- 배포는 **되돌릴 수 있어야** 합니다(“원복 버튼”이 있어야 함).
- 최소 요구사항
  - 이전 버전 이미지/아티팩트 보관
  - DB 스키마 변경은 롤백 계획(또는 forward-only 전략) 포함
  - 긴급 롤백 기준(예: error rate 상승, p95 급증) 정의

### 3.2 설정/비밀 관리
- 설정은 코드와 분리(환경변수/설정서버 등), 비밀은 별도 저장소(Secret Manager 등).
- 운영에서 자주 겪는 사고: “테스트 키/비밀번호 유출”, “환경별 설정 혼동”.

### 3.3 데이터 보호(백업/복구)
- MySQL: 백업 주기, 보관 기간, 복구 리허설(restore drill) 계획이 필수.
- Redis: 캐시로만 쓰는지, 영속 데이터(세션/토큰 등)인지에 따라 백업 전략이 달라집니다.
- Kafka: 이벤트가 “재생성 가능”한지, 원본 데이터(소스 오브 트루스)인지 합의가 필요합니다.

### 3.4 리소스/용량 계획(Capacity)
- CPU/메모리 뿐 아니라 디스크도 “언젠가 꽉 찹니다”.
- 디스크 관리 원칙(특히 로컬/도커 환경에서 자주 터짐)
  - **로그 로테이션**(컨테이너 로그)
  - **데이터 보관 상한**(Prometheus TSDB, Kafka 로그, MySQL binlog 등)
  - “얼마나 쌓이는가”를 관측(디스크 사용량 알림)

## 4) 운영 신호: RED/USE/4 Golden Signals
이 프로젝트는 HTTP API 중심이므로 RED부터 정리하는 것이 효율적입니다.

### 4.1 RED (요청 관점)
- **Rate:** 초당 요청 수(RPS)
- **Errors:** 에러 비율(5xx, 예외 증가)
- **Duration:** 지연시간(p95/p99)

### 4.2 USE (리소스 관점)
- **Utilization:** CPU/메모리/디스크 사용률
- **Saturation:** 큐/락/커넥션 대기 등 “포화”
- **Errors:** 리소스 레벨 에러(예: OOM, 디스크 full)

## 5) 장애 대응의 기본 루프
1. **감지(Detect):** 알림/대시보드에서 이상 징후 확인
2. **진단(Diagnose):** 영향 범위, 원인 후보, 최근 변경사항 파악
3. **완화(Mitigate):** 사용자 영향 최소화(트래픽 차단/기능 토글/롤백/스케일)
4. **복구(Recover):** 정상화 확인(지표 회복, 에러/지연 정상)
5. **학습(Learn):** 포스트모템(재발 방지 액션)

## 6) 포스트모템(Blameless) 작성 가이드
- **What / When / Impact / Detection / Response / Root Cause / Lessons / Action Items**
- 액션 아이템은 “누가/언제까지/검증 기준”이 있어야 합니다.
- 예:
  - “API p95 1s 이하” 같은 목표만 쓰지 말고,
  - “Prometheus alert 추가 + Grafana 패널 링크 + runbook 섹션 추가”처럼 **검증 가능한 산출물**로.

## 7) 이 레포에서 바로 참고할 자료
- 모니터링 지표 정리: `docs/week10/monitoring-metrics.md`
- 장애 대응 문서(예시): `docs/week10/step20-incident-report.md`
- 로컬 관측 스택: `observability/`

