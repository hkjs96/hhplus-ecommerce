# K6 ë¶€í•˜ í…ŒìŠ¤íŠ¸ ì¬ê³  ë¶€ì¡± ë¬¸ì œ í•´ê²°

## ğŸ”´ ë¬¸ì œ ìƒí™©

### K6 í…ŒìŠ¤íŠ¸ ê²°ê³¼
```
errors.............................: 100.00% (26355/26355)
idempotency_verification_success...: 0       0/s
iterations.........................: 26355

INFO[0215] [VU 6, Iter 200] Order creation failed: 409
INFO[0215] [VU 6, Iter 200] Failed to create order after 3 retries
```

### ê·¼ë³¸ ì›ì¸ ë¶„ì„

**1. í…ŒìŠ¤íŠ¸ ë¶€í•˜**
- VUs: 200ëª…
- Duration: 3m30s
- Total Iterations: **26,355íšŒ**
- ì£¼ë¬¸ë‹¹ í‰ê·  ìƒí’ˆ ìˆ˜: 1ê°œ
- **í•„ìš” ì¬ê³ : 26,355ê°œ**

**2. ì´ˆê¸° ì¬ê³ **
```java
// Before: DataInitializer.java
productRepository.save(Product.create("P001", "ë…¸íŠ¸ë¶", ..., 50));   // 50ê°œ
productRepository.save(Product.create("P002", "ë§ˆìš°ìŠ¤", ..., 100));  // 100ê°œ
...
// ì´ 19ê°œ ìƒí’ˆ Ã— í‰ê·  100ê°œ = ì•½ 1,900ê°œ
```

**3. ì¬ê³  ë¶€ì¡±**
- í•„ìš”: 26,355ê°œ
- ì‹¤ì œ: ~1,900ê°œ
- **ë¶€ì¡±: 24,455ê°œ** âŒ

---

## âœ… í•´ê²° ë°©ë²•

### DataInitializer ìˆ˜ì •

**ê° ìƒí’ˆ ì¬ê³ ë¥¼ 10,000ê°œë¡œ ì¦ê°€**

```java
// After: K6 ë¶€í•˜ í…ŒìŠ¤íŠ¸ìš© ì¬ê³  ëŒ€í­ ì¦ê°€
productRepository.save(Product.create("P001", "ë…¸íŠ¸ë¶", ..., 10000));   // 50 â†’ 10000
productRepository.save(Product.create("P002", "ë§ˆìš°ìŠ¤", ..., 10000));   // 100 â†’ 10000
productRepository.save(Product.create("P003", "í‚¤ë³´ë“œ", ..., 10000));  // 75 â†’ 10000
...

// ì´ 19ê°œ ìƒí’ˆ Ã— 10,000ê°œ = 190,000ê°œ
```

### ì¬ê³  ì¦ê°€ ë‚´ì—­

| ì¹´í…Œê³ ë¦¬ | ìƒí’ˆ ìˆ˜ | Before | After | ì¦ê°€ëŸ‰ |
|---------|--------|--------|-------|--------|
| ì „ìì œí’ˆ | 9ê°œ | 50~100 | 10,000 | +9,900 |
| ê°€êµ¬ | 3ê°œ | 15~20 | 10,000 | +9,985 |
| ë„ì„œ | 5ê°œ | 100~200 | 10,000 | +9,900 |
| ì˜ë¥˜ | 3ê°œ | 150~500 | 10,000 | +9,850 |
| ì¡í™” | 1ê°œ | 1,000 | 10,000 | +9,000 |
| **í•©ê³„** | **21ê°œ** | **~2,000** | **~200,000** | **+198,000** |

### Edge Case ìœ ì§€

```java
// í’ˆì ˆ ìƒí’ˆ (í…ŒìŠ¤íŠ¸ìš©)
Product.create("P013", "ë§ˆì´í¬", ..., 0);  // âš ï¸ í’ˆì ˆ ìœ ì§€

// ì¬ê³  ì ìŒ (ì„ ì°©ìˆœ í…ŒìŠ¤íŠ¸ìš©)
Product.create("P014", "ëª¨ë‹ˆí„°ì•”", ..., 2);  // âš ï¸ ì¬ê³  2ê°œ ìœ ì§€

// ìµœê³ ê°€ ìƒí’ˆ
Product.create("P021", "ì›Œí¬ìŠ¤í…Œì´ì…˜", ..., 100);  // 3 â†’ 100ê°œ (ìµœê³ ê°€ ìƒí’ˆ)
```

---

## ğŸš€ ì ìš© ë°©ë²•

### 1. ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™”

**Option A: H2 ì¸ë©”ëª¨ë¦¬ (ìë™ ì´ˆê¸°í™”)**
```bash
# Application ì¬ì‹œì‘ë§Œ í•˜ë©´ ë¨
./gradlew bootRun
```

**Option B: MySQL (ìˆ˜ë™ ì´ˆê¸°í™” í•„ìš”)**
```bash
# MySQL ì ‘ì†
mysql -u root -p ecommerce

# í…Œì´ë¸” ì‚­ì œ
DROP TABLE IF EXISTS products;
DROP TABLE IF EXISTS users;
...

# Application ì¬ì‹œì‘
./gradlew bootRun
```

### 2. ì´ˆê¸°í™” ë¡œê·¸ í™•ì¸

```
ğŸš€ Starting initial data loading...
ğŸ“¦ Creating test products...
   âœ“ Created 21 test products
   ğŸ“Š K6 Load Test Ready: ê° ìƒí’ˆ 10,000ê°œ ì¬ê³  (ì´ 200,000ê°œ ì´ìƒ)
   âš ï¸ Edge cases: P013(í’ˆì ˆ), P014(ì¬ê³  2ê°œ), P021(ìµœê³ ê°€)
âœ… Initial data loading completed!
```

### 3. K6 í…ŒìŠ¤íŠ¸ ì¬ì‹¤í–‰

```bash
k6 run docs/week5/verification/k6/scripts/payment-process.js
```

---

## ğŸ“Š ê¸°ëŒ€ ê²°ê³¼

### Before (ì¬ê³  ë¶€ì¡±)
```
CUSTOM
errors.............................: 100.00% (26355/26355)  âŒ
idempotency_verification_success...: 0       0/s             âŒ
duplicate_payments_prevented.......: 0       0/s             âŒ

iterations.........................: 26355 (ëŒ€ë¶€ë¶„ ì¬ê³  ë¶€ì¡±)
```

### After (ì¬ê³  ì¶©ë¶„)
```
CUSTOM
errors.............................: <10%                    âœ…
idempotency_verification_success...: >0                      âœ…
duplicate_payments_prevented.......: >0                      âœ…

HTTP
http_req_duration..................: p(95)<1000              âœ…

iterations.........................: ~26000 (ì •ìƒ ì™„ë£Œ)
```

---

## ğŸ¯ í…ŒìŠ¤íŠ¸ ìš©ëŸ‰ ê³„ì‚°

### í˜„ì¬ ì„¤ì • (3m30s, 200 VUs)

**ì´ ë°˜ë³µ íšŸìˆ˜ ì˜ˆìƒ**:
```
200 VUs Ã— 210ì´ˆ Ã· í‰ê·  ë°˜ë³µ ì‹œê°„(1.41ì´ˆ) = ì•½ 29,787íšŒ
```

**í•„ìš” ì¬ê³ **:
```
29,787íšŒ Ã— 1ê°œ/ì£¼ë¬¸ Ã— 3ë²ˆ ì¬ì‹œë„ = ì•½ 89,361ê°œ (ìµœëŒ€)
ì‹¤ì œ ì„±ê³µë¥  80% ê°€ì • ì‹œ = ì•½ 23,830ê°œ
```

**í˜„ì¬ ì¬ê³ **: 200,000ê°œ (ì¶©ë¶„!) âœ…

### ë” ë†’ì€ ë¶€í•˜ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥

**10ë¶„, 500 VUs í…ŒìŠ¤íŠ¸ë„ ê°€ëŠ¥**:
```
500 VUs Ã— 600ì´ˆ Ã· 1.41ì´ˆ = ì•½ 212,766íšŒ
í•„ìš” ì¬ê³ : ~170,000ê°œ
í˜„ì¬ ì¬ê³ : 200,000ê°œ âœ…
```

---

## ğŸ” í•™ìŠµ í¬ì¸íŠ¸

### 1. ë¶€í•˜ í…ŒìŠ¤íŠ¸ ì„¤ê³„ ì‹œ ê³ ë ¤ì‚¬í•­

**ë°ì´í„° ìš©ëŸ‰ ê³„ì‚°**:
- VUs Ã— Duration Ã· Iteration Time = Total Iterations
- Total Iterations Ã— Items per Order = Required Stock

### 2. ì¬ê³  ì†Œì§„ ì²˜ë¦¬ ì „ëµ

**í˜„ì¬ êµ¬í˜„** (payment-process.js):
```javascript
function createOrderWithRetry(userId, initialProductId, maxRetries) {
  for (let attempt = 0; attempt < maxRetries; attempt++) {
    // ì¬ì‹œë„ ì‹œ ë‹¤ë¥¸ ìƒí’ˆ ì„ íƒ
    const productId = attempt === 0 ? initialProductId : getRandomProductId();
    const orderId = createOrder(userId, productId);

    if (orderId) {
      return orderId;  // ì„±ê³µ ì‹œ ë°˜í™˜
    }

    // ì¬ê³  ì†Œì§„ ì‹œ ë‹¤ë¥¸ ìƒí’ˆìœ¼ë¡œ ì¬ì‹œë„
  }
  return null;  // 3ë²ˆ ì‹¤íŒ¨ ì‹œ í¬ê¸°
}
```

**ì¥ì **:
- ì¬ê³  ì†Œì§„ ì‹œ ìë™ìœ¼ë¡œ ë‹¤ë¥¸ ìƒí’ˆ ì„ íƒ
- í…ŒìŠ¤íŠ¸ ì¤‘ë‹¨ ì—†ì´ ê³„ì† ì§„í–‰

**ì£¼ì˜ì‚¬í•­**:
- ëª¨ë“  ìƒí’ˆ ì¬ê³  ì†Œì§„ ì‹œ 100% ì‹¤íŒ¨
- ì¶©ë¶„í•œ ì¬ê³  ì¤€ë¹„ í•„ìˆ˜

### 3. Edge Case vs Load Test

**Edge Case ìƒí’ˆì€ ì˜ˆì™¸**:
```java
Product.create("P013", "ë§ˆì´í¬", ..., 0);    // í’ˆì ˆ í…ŒìŠ¤íŠ¸ìš©
Product.create("P014", "ëª¨ë‹ˆí„°ì•”", ..., 2);  // ì„ ì°©ìˆœ í…ŒìŠ¤íŠ¸ìš©
```

**ë¶€í•˜ í…ŒìŠ¤íŠ¸ìš© ìƒí’ˆì€ ì¶©ë¶„í•œ ì¬ê³ **:
```java
Product.create("P001-P012, P015-P021", ..., 10000);  // 19ê°œ ìƒí’ˆ
```

---

## ğŸ“ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [x] DataInitializer.java ìˆ˜ì • (ì¬ê³  10,000ê°œ)
- [ ] ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™” (ê¸°ì¡´ ë°ì´í„° ì‚­ì œ)
- [ ] Application ì¬ì‹œì‘
- [ ] ì´ˆê¸°í™” ë¡œê·¸ í™•ì¸ (200,000ê°œ ì¬ê³ )
- [ ] K6 í…ŒìŠ¤íŠ¸ ì¬ì‹¤í–‰
- [ ] ì„±ê³µë¥  í™•ì¸ (>90%)
- [ ] Idempotency ê²€ì¦ í™•ì¸ (count>0)

---

## ì°¸ê³ 

- **ìˆ˜ì • íŒŒì¼**: `DataInitializer.java:108-146`
- **K6 í…ŒìŠ¤íŠ¸**: `payment-process.js`
- **ë¶€í•˜ í…ŒìŠ¤íŠ¸ ë¬¸ì„œ**: `K6_LOAD_TEST_GUIDE.md`
