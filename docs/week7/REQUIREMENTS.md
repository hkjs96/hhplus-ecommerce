# Week 7 과제 요구사항

## 📌 과제 개요

**주제:** Redis 자료구조를 활용한 랭킹 시스템 및 선착순 쿠폰 발급

**목표:**
- Redis의 특성에 따른 활용 방식을 고민하고 올바른 설계로 구현
- 다량의 트래픽을 처리하기 위해 적은 DB 부하로 올바르게 기능 제공

---

## 🎯 STEP 13: Ranking Design

### 이커머스 시나리오
가장 많이 주문한 상품 랭킹을 Redis 기반으로 설계 및 구현

### 핵심 요구사항
- [ ] Redis Sorted Set 기반 랭킹 시스템 설계
- [ ] 적절한 트랜잭션 및 파이프라인 구성
- [ ] **결제 완료 시점**에 랭킹 갱신 (주문 생성 시점 ❌)
- [ ] 실시간성 보장 (비동기 처리)

### Pass 조건
- ✅ 부합하는 랭킹을 제공하기 위해 적절한 트랜잭션 선정
- ✅ Redis Sorted Set 기반의 랭킹 제공 로직 구현
- ✅ 파이프라인 구성 (결제 완료 → 랭킹 갱신)

---

## 🎯 STEP 14: Asynchronous Design

### 이커머스 시나리오
선착순 쿠폰 발급 기능을 Redis 기반으로 설계 및 개선

### 핵심 요구사항
- [ ] Redis 기반 선착순 쿠폰 발급 시스템 설계
- [ ] 적절한 자료구조 선택 (Set, String 등)
- [ ] 동시성 제어 및 정합성 보장
  - 수량 차감과 발급 기록은 **트랜잭션 단위**로 처리
  - 스케줄러로 나중에 맞추는 방식 ❌
- [ ] 기존 RDBMS 로직을 Redis 로직으로 마이그레이션

### Pass 조건
- ✅ Redis를 활용해 비동기로 동작하는 시스템으로 개선
- ✅ 기존 RDBMS 기반 로직을 Redis 기반으로 누락 없이 마이그레이션
- ✅ 동시성 이슈 원천 차단 (수량 초과 발급 방지)

---

## 📋 핵심 체크리스트

### ✅ Ranking Design
- [ ] 적절한 설계를 기반으로 랭킹 기능이 개발되었는가?
- [ ] 적절한 자료구조를 선택하였는가? (Sorted Set)
- [ ] 결제 완료 시점에 랭킹이 갱신되는가?
- [ ] 동시성 이슈가 없는가? (ZINCRBY의 원자성 활용)

### ✅ Asynchronous Design
- [ ] 적절한 설계를 기반으로 쿠폰 발급 기능이 개발되었는가?
- [ ] 적절한 자료구조를 선택하였는가? (Set, String)
- [ ] 수량 차감과 발급 기록이 트랜잭션으로 묶였는가?
- [ ] 중복 발급이 방지되는가?

### ✅ 통합 테스트
- [ ] Redis Testcontainer를 통해 독립적 테스트 환경을 보장하는가?
- [ ] 핵심 기능에 대한 흐름이 테스트에서 검증되었는가?
- [ ] 동시성을 검증할 수 있는 테스트 코드가 작성되었는가?

---

## 📊 평가 기준

### Pass 조건 (필수)
1. **Redis 특성 이해**
   - 단일 스레드 이벤트 루프 특성 이해
   - 원자적 연산 활용 (ZINCRBY, DECR, SADD 등)
   - Lua 스크립트는 짧게 작성

2. **실시간 랭킹 시스템**
   - Sorted Set을 활용한 랭킹 구현
   - 적절한 트랜잭션 및 파이프라인 구성
   - 결제 완료 시점에 랭킹 갱신

3. **선착순 쿠폰 발급**
   - 수량 차감 + 발급 기록 트랜잭션
   - 중복 발급 방지
   - 동시성 제어 (Race Condition 방지)

4. **마이그레이션 완성도**
   - RDBMS 로직을 Redis 로직으로 누락 없이 전환
   - 기존 기능 안정성 유지

### 도전 항목 (심화)
- [ ] Redis 인터페이스 설계의 일관성과 추상화
- [ ] DIP 적용으로 비즈니스 로직 보호
- [ ] RedisTemplate 활용한 의존성 최소화
- [ ] Redis 자료구조의 적절한 시스템 디자인
- [ ] 보고서의 명확한 구성 (배경, 문제해결, 테스트, 한계점, 결론)

---

## ⚠️ 주의사항

### Redis 사용 시
1. **Lua 스크립트:**
   - 짧게 작성 (Redis 단일 스레드 특성)
   - CPU 연산 최소화
   - 복잡한 로직은 Application 레벨에서 처리

2. **트랜잭션:**
   - 수량 차감과 발급 기록은 반드시 함께 처리
   - 실패 시 롤백 로직 필수
   - 스케줄러로 나중에 맞추는 방식 절대 금지

3. **TTL 관리:**
   - 모든 키에 TTL 설정 (메모리 누수 방지)
   - 일간/주간 랭킹 분리 관리
   - 쿠폰 유효기간과 Redis TTL 일치

### 동시성 제어
1. **랭킹 갱신:**
   - ZINCRBY는 원자적 → 별도 분산락 불필요
   - 100개 동시 요청 → score 정확히 100 증가

2. **쿠폰 발급:**
   - Lua 스크립트 또는 개별 명령 + 롤백
   - 수량이 0 미만으로 내려가면 안 됨
   - 같은 userId 중복 발급 방지

---

## 📝 제출 사항

### 코드
- [ ] Redis 기반 랭킹 시스템 구현
- [ ] Redis 기반 쿠폰 발급 시스템 구현
- [ ] Testcontainers 기반 통합 테스트
- [ ] 동시성 검증 테스트

### 문서
- [ ] 시스템 디자인 설계 보고서
  - 배경 (왜 Redis를 사용하는가?)
  - 문제 해결 (어떻게 구현했는가?)
  - 테스트 (어떻게 검증했는가?)
  - 한계점 (무엇이 부족한가?)
  - 결론 (무엇을 배웠는가?)

### PR 템플릿
```markdown
## :pushpin: PR 제목 규칙
[STEP13-14] 이름

---
### **핵심 체크리스트** :white_check_mark:

#### :one: ranking design
- [ ] 적절한 설계를 기반으로 랭킹기능이 개발되었는가?
- [ ] 적절한 자료구조를 선택하였는가?

#### :two: Asynchronous Design
- [ ] 적절한 설계를 기반으로 쿠폰 발급 기능이 개발되었는가?
- [ ] 적절한 자료구조를 선택하였는가?

#### :three: 통합 테스트
- [ ] redis 테스트 컨테이너를 통해 적절하게 통합 테스트가 작성되었는가?
- [ ] 핵심 기능에 대한 흐름이 테스트에서 검증되었는가?
```

---

## 🎓 학습 목표

### STEP 13: Ranking Design
**핵심 역량:**
- Redis Sorted Set 활용
- 실시간 랭킹 시스템 구축
- Redis atomicity 이해
- 수집하고자 하는 기능적 작업 단위 분석

### STEP 14: Asynchronous Design
**핵심 역량:**
- 실시간 분산 처리 이해
- 분산 환경에서의 안정성 확보
- 스케줄링 기반 처리 설계 (선택적)
- Redis 명령어 체험 및 자료구조 이해

---

## 📚 참고 자료

### 필수 문서
- `agent_docs/redis_ranking.md` - 랭킹 시스템 구현 가이드
- `agent_docs/redis_coupon_issue.md` - 쿠폰 발급 구현 가이드
- `agent_docs/testing_redis_features.md` - 테스트 시나리오

### 학습 자료
- `docs/week7/LEARNING_ROADMAP.md` - 10시간/3시간 학습 로드맵
- `docs/week7/COACH_QNA_SUMMARY.md` - 코치 QnA 핵심 요약
- `docs/week7/REDIS_BASICS.md` - Redis 기초 개념

### 참고 링크
- [Redis 공식 문서](https://redis.io/docs/)
- [Redis Sorted Sets](https://redis.io/docs/data-types/sorted-sets/)
- [Testcontainers Redis](https://java.testcontainers.org/modules/databases/redis/)

---

## 🚀 다음 단계

1. **학습:** `LEARNING_ROADMAP.md` 참조하여 Redis 기초 학습
2. **설계:** 랭킹/쿠폰 시스템 설계 (키 네이밍, 자료구조 선택)
3. **구현:** `agent_docs/` 문서 참조하여 구현
4. **테스트:** Testcontainers로 동시성 검증
5. **보고서:** 설계 및 구현 과정 문서화
